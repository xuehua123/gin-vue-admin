<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-item { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeeba; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å‰ç«¯è°ƒè¯•é¡µé¢</h1>
    <p>å½“å‰æ—¶é—´: <span id="current-time"></span></p>
    
    <div id="test-results">
        <div id="env-test" class="test-item loading">
            <h3>ğŸ“‹ ç¯å¢ƒå˜é‡æµ‹è¯•</h3>
            <div id="env-result">æ­£åœ¨æ£€æµ‹...</div>
        </div>
        
        <div id="api-test" class="test-item loading">
            <h3>ğŸ”— APIè¿æ¥æµ‹è¯•</h3>
            <div id="api-result">æ­£åœ¨æµ‹è¯•...</div>
        </div>
        
        <div id="cors-test" class="test-item loading">
            <h3>ğŸŒ è·¨åŸŸæµ‹è¯•</h3>
            <div id="cors-result">æ­£åœ¨æµ‹è¯•...</div>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button onclick="runAllTests()">ğŸ”„ é‡æ–°è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="testLogin()">ğŸ” æµ‹è¯•ç™»å½•æ¥å£</button>
        <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤ç»“æœ</button>
    </div>

    <script>
        // æ›´æ–°å½“å‰æ—¶é—´
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // æ˜¾ç¤ºç»“æœçš„è¾…åŠ©å‡½æ•°
        function showResult(elementId, status, content) {
            const element = document.getElementById(elementId);
            element.className = `test-item ${status}`;
            element.querySelector('div').innerHTML = content;
        }

        // ç¯å¢ƒå˜é‡æµ‹è¯•
        function testEnvironment() {
            try {
                const envInfo = {
                    'User Agent': navigator.userAgent,
                    'Location': window.location.href,
                    'Protocol': window.location.protocol,
                    'Host': window.location.host,
                    'Port': window.location.port || 'é»˜è®¤ç«¯å£',
                    'Pathname': window.location.pathname
                };
                
                let result = '<pre>';
                for (const [key, value] of Object.entries(envInfo)) {
                    result += `${key}: ${value}\n`;
                }
                result += '</pre>';
                
                showResult('env-test', 'success', result);
            } catch (error) {
                showResult('env-test', 'error', `ç¯å¢ƒæ£€æµ‹å¤±è´¥: ${error.message}`);
            }
        }

        // APIè¿æ¥æµ‹è¯•
        async function testAPI() {
            try {
                showResult('api-test', 'loading', 'æ­£åœ¨æµ‹è¯•APIè¿æ¥...');
                
                // æµ‹è¯•å¥åº·æ£€æŸ¥
                const healthResponse = await fetch('/api/health', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (healthResponse.ok) {
                    const healthText = await healthResponse.text();
                    showResult('api-test', 'success', `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${healthText}`);
                } else {
                    showResult('api-test', 'error', `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${healthResponse.status} ${healthResponse.statusText}`);
                }
            } catch (error) {
                showResult('api-test', 'error', `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`);
            }
        }

        // è·¨åŸŸæµ‹è¯•
        async function testCORS() {
            try {
                showResult('cors-test', 'loading', 'æ­£åœ¨æµ‹è¯•è·¨åŸŸé…ç½®...');
                
                // æµ‹è¯•éªŒè¯ç æ¥å£
                const corsResponse = await fetch('/api/base/captcha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (corsResponse.ok) {
                    const corsData = await corsResponse.json();
                    showResult('cors-test', 'success', `âœ… è·¨åŸŸé…ç½®æ­£å¸¸ï¼ŒéªŒè¯ç æ¥å£è¿”å›: ${JSON.stringify(corsData).substring(0, 100)}...`);
                } else {
                    showResult('cors-test', 'error', `âŒ è·¨åŸŸè¯·æ±‚å¤±è´¥: ${corsResponse.status} ${corsResponse.statusText}`);
                }
            } catch (error) {
                showResult('cors-test', 'error', `âŒ è·¨åŸŸæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•ç™»å½•æ¥å£
        async function testLogin() {
            try {
                const testData = {
                    username: "admin",
                    password: "123456"
                };
                
                const response = await fetch('/api/base/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                alert(`ç™»å½•æµ‹è¯•ç»“æœ: ${JSON.stringify(result, null, 2)}`);
            } catch (error) {
                alert(`ç™»å½•æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            testEnvironment();
            testAPI();
            testCORS();
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            const testItems = document.querySelectorAll('.test-item');
            testItems.forEach(item => {
                item.className = 'test-item loading';
                item.querySelector('div').innerHTML = 'ç­‰å¾…æµ‹è¯•...';
            });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html> 