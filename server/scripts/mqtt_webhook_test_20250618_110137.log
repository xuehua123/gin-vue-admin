[2025-06-18 11:01:37] 
================================================================================
[2025-06-18 11:01:37]   MQTT Webhook API 自动化测试脚本 (Python)
[2025-06-18 11:01:37] ================================================================================
[2025-06-18 11:01:37] ℹ️  测试目标: http://43.165.186.134:8888
[2025-06-18 11:01:37] ℹ️  日志文件: mqtt_webhook_test_20250618_110137.log
[2025-06-18 11:01:37] ℹ️  开始时间: 2025-06-18 11:01:37
[2025-06-18 11:01:37] 
================================================================================
[2025-06-18 11:01:37]   服务器连通性
[2025-06-18 11:01:37] ================================================================================
[2025-06-18 11:01:38] ✅ 服务器连通性正常 (能收到404响应)
[2025-06-18 11:01:38] 
================================================================================
[2025-06-18 11:01:38]   测试1: 角色请求Hook - 正常分配角色
[2025-06-18 11:01:38] ================================================================================
[2025-06-18 11:01:38] ℹ️  正在测试: 正常角色分配
[2025-06-18 11:01:38] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/role_request
[2025-06-18 11:01:38] ℹ️  请求数据: {
  "clientid": "user123-mobile-1750215698",
  "username": "user123",
  "topic": "nfc_relay/role_request",
  "payload": {
    "role": "mobile",
    "force_kick": false,
    "device_info": {
      "device_model": "iPhone 14",
      "os_version": "iOS 16.0",
      "app_version": "1.0.0"
    }
  },
  "timestamp": 1750215698
}
[2025-06-18 11:01:39] ✅ [正常角色分配] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:39] ℹ️  响应数据:
[2025-06-18 11:01:39] {
  "code": 0,
  "msg": "角色分配成功",
  "data": {
    "action": "role_assigned"
  }
}
[2025-06-18 11:01:39] 
================================================================================
[2025-06-18 11:01:39]   测试2: 角色请求Hook - 角色冲突检测
[2025-06-18 11:01:39] ================================================================================
[2025-06-18 11:01:39] ℹ️  正在测试: 角色冲突检测 (无真实冲突)
[2025-06-18 11:01:39] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/role_request
[2025-06-18 11:01:39] ℹ️  请求数据: {
  "clientid": "user123-pc-1750215699",
  "username": "user123",
  "topic": "nfc_relay/role_request",
  "payload": {
    "role": "pc",
    "force_kick": false,
    "device_info": {
      "device_model": "Windows PC",
      "os_version": "Windows 11"
    }
  },
  "timestamp": 1750215699
}
[2025-06-18 11:01:39] ✅ [角色冲突检测 (无真实冲突)] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:39] ℹ️  响应数据:
[2025-06-18 11:01:39] {
  "code": 0,
  "msg": "角色分配成功",
  "data": {
    "action": "role_assigned"
  }
}
[2025-06-18 11:01:39] 
================================================================================
[2025-06-18 11:01:39]   测试3: 角色请求Hook - 强制踢下线
[2025-06-18 11:01:39] ================================================================================
[2025-06-18 11:01:39] ℹ️  正在测试: 强制踢下线
[2025-06-18 11:01:39] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/role_request
[2025-06-18 11:01:39] ℹ️  请求数据: {
  "clientid": "user123-pc-force-1750215699",
  "username": "user123",
  "topic": "nfc_relay/role_request",
  "payload": {
    "role": "pc",
    "force_kick": true,
    "device_info": {
      "device_model": "Windows PC New"
    }
  },
  "timestamp": 1750215699
}
[2025-06-18 11:01:39] ✅ [强制踢下线] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:39] ℹ️  响应数据:
[2025-06-18 11:01:39] {
  "code": 0,
  "msg": "角色分配成功",
  "data": {
    "action": "role_assigned"
  }
}
[2025-06-18 11:01:39] 
================================================================================
[2025-06-18 11:01:39]   测试4: 角色请求Hook - 无效ClientID格式
[2025-06-18 11:01:39] ================================================================================
[2025-06-18 11:01:39] ℹ️  正在测试: 无效ClientID格式
[2025-06-18 11:01:39] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/role_request
[2025-06-18 11:01:39] ℹ️  请求数据: {
  "clientid": "invalid_format",
  "username": "user123",
  "topic": "nfc_relay/role_request",
  "payload": {
    "role": "mobile"
  },
  "timestamp": 1750215699
}
[2025-06-18 11:01:40] ✅ [无效ClientID格式] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:40] ℹ️  响应数据:
[2025-06-18 11:01:40] {
  "code": 0,
  "msg": "角色分配成功",
  "data": {
    "action": "role_assigned"
  }
}
[2025-06-18 11:01:40] 
================================================================================
[2025-06-18 11:01:40]   测试5: 连接状态Hook - 客户端连接
[2025-06-18 11:01:40] ================================================================================
[2025-06-18 11:01:40] ℹ️  正在测试: 客户端连接事件
[2025-06-18 11:01:40] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/connection_status
[2025-06-18 11:01:40] ℹ️  请求数据: {
  "event_type": "client_connected",
  "clientid": "user123-mobile-1750215700",
  "username": "user123",
  "connected_at": "2025-06-18T11:01:40.473917"
}
[2025-06-18 11:01:40] ✅ [客户端连接事件] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:40] ℹ️  响应数据:
[2025-06-18 11:01:40] {
  "code": 0,
  "data": {},
  "msg": "状态更新成功"
}
[2025-06-18 11:01:40] 
================================================================================
[2025-06-18 11:01:40]   测试6: 连接状态Hook - 客户端断开
[2025-06-18 11:01:40] ================================================================================
[2025-06-18 11:01:40] ℹ️  正在测试: 客户端断开事件
[2025-06-18 11:01:40] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/connection_status
[2025-06-18 11:01:40] ℹ️  请求数据: {
  "event_type": "client_disconnected",
  "clientid": "user123-mobile-1750215700",
  "username": "user123",
  "disconnected_at": "2025-06-18T11:01:40.892465",
  "reason": "normal"
}
[2025-06-18 11:01:41] ✅ [客户端断开事件] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:41] ℹ️  响应数据:
[2025-06-18 11:01:41] {
  "code": 0,
  "data": {},
  "msg": "状态更新成功"
}
[2025-06-18 11:01:41] 
================================================================================
[2025-06-18 11:01:41]   测试7: 连接状态Hook - 无效事件类型
[2025-06-18 11:01:41] ================================================================================
[2025-06-18 11:01:41] ℹ️  正在测试: 无效事件类型
[2025-06-18 11:01:41] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/connection_status
[2025-06-18 11:01:41] ℹ️  请求数据: {
  "event_type": "invalid_event",
  "clientid": "test-client",
  "username": "testuser"
}
[2025-06-18 11:01:41] ✅ [无效事件类型] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:41] ℹ️  响应数据:
[2025-06-18 11:01:41] {
  "code": 0,
  "data": {},
  "msg": "状态更新成功"
}
[2025-06-18 11:01:41] 
================================================================================
[2025-06-18 11:01:41]   测试8: 参数错误测试 - 缺少必要字段
[2025-06-18 11:01:41] ================================================================================
[2025-06-18 11:01:41] ℹ️  正在测试: 缺少必要字段
[2025-06-18 11:01:41] ℹ️  请求URL: http://43.165.186.134:8888/mqtt/hooks/role_request
[2025-06-18 11:01:41] ℹ️  请求数据: {
  "clientid": "test-client"
}
[2025-06-18 11:01:42] ✅ [缺少必要字段] 测试通过 (HTTP 200 OK)
[2025-06-18 11:01:42] ℹ️  响应数据:
[2025-06-18 11:01:42] {
  "code": 0,
  "msg": "角色分配成功",
  "data": {
    "action": "role_assigned"
  }
}
[2025-06-18 11:01:42] 
================================================================================
[2025-06-18 11:01:42]   测试结果汇总
[2025-06-18 11:01:42] ================================================================================
[2025-06-18 11:01:42] ℹ️  总测试数: 9
[2025-06-18 11:01:42] ✅ 成功: 9
[2025-06-18 11:01:42] ❌ 失败: 0
[2025-06-18 11:01:42] ℹ️  成功率: 100.00%
[2025-06-18 11:01:42] ✅   - 服务器连通性                         [  OK  ]
[2025-06-18 11:01:42] ✅   - 正常角色分配                         [  OK  ]
[2025-06-18 11:01:42] ✅   - 角色冲突检测 (无真实冲突)                 [  OK  ]
[2025-06-18 11:01:42] ✅   - 强制踢下线                          [  OK  ]
[2025-06-18 11:01:42] ✅   - 无效ClientID格式                   [  OK  ]
[2025-06-18 11:01:42] ✅   - 客户端连接事件                        [  OK  ]
[2025-06-18 11:01:42] ✅   - 客户端断开事件                        [  OK  ]
[2025-06-18 11:01:42] ✅   - 无效事件类型                         [  OK  ]
[2025-06-18 11:01:42] ✅   - 缺少必要字段                         [  OK  ]
[2025-06-18 11:01:42] 
================================================================================
[2025-06-18 11:01:42]   测试完成
[2025-06-18 11:01:42] ================================================================================
[2025-06-18 11:01:42] ℹ️  完成时间: 2025-06-18 11:01:42
[2025-06-18 11:01:42] ℹ️  详细日志已保存到: D:\work\IdeaProjects\gin-vue-admin\server\scripts\mqtt_webhook_test_20250618_110137.log
[2025-06-18 11:01:42] ✅ 
所有测试通过! 🎉
