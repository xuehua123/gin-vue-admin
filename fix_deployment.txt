# ğŸ”§ ä¿®å¤éƒ¨ç½²é—®é¢˜ - è¯·åœ¨æœåŠ¡å™¨ä¸Šé€è¡Œæ‰§è¡Œ

# 1. è¿›å…¥éƒ¨ç½²ç›®å½•
cd /opt/gin-vue-admin

# 2. ä¿®å¤è„šæœ¬æ ¼å¼é—®é¢˜ï¼ˆè½¬æ¢æ¢è¡Œç¬¦ï¼‰
sed -i 's/\r$//' start.sh

# 3. æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
ps aux | grep server

# 4. åˆ›å»ºnginxé…ç½®ç›®å½•
mkdir -p /etc/nginx/conf.d

# 5. æ‰‹åŠ¨åˆ›å»ºnginxé…ç½®æ–‡ä»¶
cat > /etc/nginx/conf.d/gin-vue-admin.conf << 'EOF'
server {
    listen 80;
    server_name _;
    
    location / {
        root /opt/gin-vue-admin/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }
    
    location /api/ {
        proxy_pass http://127.0.0.1:8888/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF

# 6. å®‰è£…å¹¶å¯åŠ¨nginx
yum install -y nginx || apt-get update && apt-get install -y nginx

# 7. æ£€æŸ¥nginxé…ç½®
nginx -t

# 8. å¯åŠ¨nginx
systemctl start nginx
systemctl enable nginx

# 9. å¼€æ”¾é˜²ç«å¢™ç«¯å£ï¼ˆæ ¹æ®ç³»ç»Ÿé€‰æ‹©ï¼‰
# CentOS/RHEL:
firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload

# æˆ–è€… Ubuntu:
# ufw allow 80

# 10. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep :80

# 11. æ£€æŸ¥nginxçŠ¶æ€
systemctl status nginx

# 12. å¦‚æœåç«¯æœåŠ¡æ²¡å¯åŠ¨ï¼Œæ‰‹åŠ¨å¯åŠ¨
chmod +x ./server
nohup ./server > server.log 2>&1 &

# 13. æ£€æŸ¥æ‰€æœ‰æœåŠ¡
echo "=== æœåŠ¡çŠ¶æ€ ==="
systemctl status nginx
echo "=== ç«¯å£ç›‘å¬ ==="
netstat -tlnp | grep -E ":80|:8888"
echo "=== è¿›ç¨‹çŠ¶æ€ ==="
ps aux | grep -E "nginx|server" 